<!DOCTYPE html>
<html>
<head>
    <title>Crash Heatmap</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <style>
         /* Always set the map height explicitly to define the size of the div
        * element that contains the map. */
         #map {
             height: 100%;
         }
         /* Optional: Makes the sample page fill the window. */
         html, body {
             height: 100%;
             margin: 0;
             padding: 0;
         }
    </style>
</head>
<body>
    <!--{% block content %}{% endblock %}-->
    <h1>Texas Crash Heatmap</h1>
    <p>This page shows the heatmap for a sample of Texas highway crashes for 2015 crash database. The heatmaps will be used in this project to show the clusters of similar crashes (or hotspots). </p>

    <div id="map"></div>
    <script>
        var map;
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 5,
                center: {lat: 32, lng: -82},
                mapTypeId: 'terrain'
            });
        };

        var crashdata = [];
        document.write("We ARE HERE")
        $(function () {
            $.getJSON('https://scidriver.herokuapp.com/static/crashdata.json', function (data) {
                $.each(data.crash, function (i, f) {
                    var latLng = [f.LAT, f.LON];
                    crashdata.append(latLng);
                });
            });
        });
        document.write(crashdata)
        eqfeed_callback(crashdata)
        function eqfeed_callback(results) {
            var heatmapData = [];
            for (var i = 0; i < results.length; i++) {
                var coords = results[i];
                var latLng = new google.maps.LatLng(coords[0], coords[1]);
                heatmapData.push(latLng);
            }
        var heatmap = new google.maps.visualization.HeatmapLayer({
          data: heatmapData,
          dissipating: false,
          radius: 10,
          map: map
        });
      }
    </script>
    <script
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB_4Q-IAnHrf2Vy4p78pw0PbobJNP61JE4&libraries=visualization&callback=initMap">
    </script>
</body>
</html>
